---
// const { deckID = ''} = Astro.props
---
<!-- TODO: make this into react or something so i don't need to make a custom element -->
<!-- <draw-button data-deck_id={deckID}> -->
<draw-button>
  <button class="draw-btn">Draw</button>
</draw-button>

<script>
  import { $deckId } from '../utils/deckStores.js'

  class DrawButton extends HTMLElement {
    constructor() {
      super()
    // connectedCallBack() {
      // const deckID = this.dataset.deck_id

      const button = this.querySelector('button.draw-btn')
      button.addEventListener('click', () => {

      const url = `https://deckofcardsapi.com/api/deck/${$deckId.get()}/draw/?count=2`

      fetch(url)
        .then(res => res.json()) // parse response as JSON
        .then(data => {
          console.log(data)
          document.querySelector('img.player1').src = data.cards[0].image
          document.querySelector('img.player2').src = data.cards[1].image
          document.querySelector('h2.status').innerText = whoWin(data.cards[0].value, data.cards[1].value)
        })
        .catch(err => {
          console.log(`error ${err}`)
        })
      })
    }
  }

  customElements.define('draw-button', DrawButton)

  function whoWin(player1, player2) {
    let arr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'JACK', 'QUEEN', 'KING', 'ACE']
    let p1 = arr.indexOf(player1)
    let p2 = arr.indexOf(player2)

    console.log(p1, typeof p1, p2, typeof p2)
    return p1 == p2 ? "WAR!" : p1 > p2 ? "PLAYER 1 WON" : "PLAYER 2 WON"
  }
</script>
