<!-- TODO: make this into react or something so i don't need to make a custom element -->
<draw-button>
  <button class="draw-btn">Draw</button>
</draw-button>

<script>
  import { $deckId } from '../utils/deckStores.js'
  import { $handLimit, $currentHand } from '../utils/hand.js'

  class DrawButton extends HTMLElement {
    constructor() {
      super()
    // connectedCallBack() {
      // const deckID = this.dataset.deck_id

      const button = this.querySelector('button.draw-btn')
      button.addEventListener('click', () => {

      // const url = `https://deckofcardsapi.com/api/deck/${$deckId.get()}/draw/?count=2`
        const url = `https://deckofcardsapi.com/api/deck/${$deckId.get()}/draw/?count=${$handLimit.get() - $currentHand.get()}`

      fetch(url)
        .then(res => res.json()) // parse response as JSON
        .then(data => {
          console.log(data)
          // document.querySelector('img.player1').src = data.cards[0].image
          // document.querySelector('img.player2').src = data.cards[1].image
          // document.querySelector('h2.status').innerText = whoWin(data.cards[0].value, data.cards[1].value)

          $currentHand.set(data.cards.length)
          console.log($currentHand.get())

          //Card display logic
          // document.querySelector('div.hand-card-container').
          data.cards.forEach(element => {
            const div = document.createElement('div')
            const img = document.createElement('img')
            const input = document.createElement('input')
            // div.textContent = element.name
            input.type = 'checkbox'
            input.value = element.value
            img.src = element.image
            div.appendChild(img)
            div.appendChild(input)
            document.querySelector('div.hand-card-container').appendChild(div)
          })
        })
        .catch(err => {
          console.log(`error ${err}`)
        })
      })
    }
  }

  customElements.define('draw-button', DrawButton)

  // function whoWin(player1:string, player2:string) {
  //   let arr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'JACK', 'QUEEN', 'KING', 'ACE']
  //   let p1 = arr.indexOf(player1)
  //   let p2 = arr.indexOf(player2)
  //
  //   console.log(p1, typeof p1, p2, typeof p2)
  //   return p1 == p2 ? "WAR!" : p1 > p2 ? "PLAYER 1 WON" : "PLAYER 2 WON"
  // }
</script>
